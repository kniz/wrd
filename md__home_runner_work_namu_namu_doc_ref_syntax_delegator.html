<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>world-doc: delegator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">world-doc
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">delegator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>메소드를 정의하면 그것이 곧 delegator로 사용할 수 있다.</h1>
<div class="fragment"><div class="line">cb(msg str) void = null // just interface. can&#39;t call this function directly.</div>
<div class="line">cb2(msg str) void: ret // returining void. it&#39;s accessible.</div>
<div class="line">foo(msg str, @cb) void</div>
<div class="line">    cb(str)</div>
</div><!-- fragment --><h1>func과 nested func은 delegator를 생성하는 API를 각각 다른 방법으로 제공한다.</h1>
<ul>
<li>일반 func의 경우 특정한 objscope에 대해서 scope capture를 하면 된다.</li>
<li>반면 nested func의 경우 outer func의 localscope 까지 모두 capture가 되어야 한다.<ul>
<li>nested func은 outer func 안에 있는 상황이기 때문에, 모든 시나리오에서 이 nested func에 접근하려면 이미 outer func의 S, NS가 scope에 올라간 상황이 된다.</li>
<li>nested func은 이 outer func의 scope에 크게 의존하고 있는 특수한 문법이므로 capture가 될때에도 outerscope 위에 자신의 것이 capture가 되어야 한다.</li>
</ul>
</li>
<li>일반 func과 nested func은 모두 delegate() Delegator 를 제공하며, nested Func은 이것을 override 해서 localscope도 capture가 되도록 만든다.</li>
<li>implicitCast(type) 혹은 as(type) 에서 func이 들어온 경우에는 현재의 stackframe으로부터 호출자 frame을 [1] 로 추출하여 thisobj로 eval 한 다음에 수행한다.<ul>
<li>단순히 stackframe[1] 알고리즘으로는 native 환경에서 주의 깊지 못한 개발자가 잘못 호출하면 stackframe이 엉망이 된 상태에서 호출자 frame을 유추하지 못할 수 있다.</li>
</ul>
</li>
</ul>
<h1>메소드에 접근하는 expr은 Delegator로 캐스팅 될 수 있다.</h1>
<ul>
<li>객체를 통해 func에 접근하는 경우: <div class="fragment"><div class="line">def person</div>
<div class="line">    sayHello(name str) void</div>
<div class="line">func := person.sayHello</div>
<div class="line"> </div>
<div class="line">DeclExpr(&quot;func&quot;, FuncType(sayHello), AccessExpr(AccessExpr(scope, &quot;person&quot;), &quot;sayHello&quot;))</div>
</div><!-- fragment --><ul>
<li>이 경우 DeclExpr은 AccessExpr(AccessExpr(scope, "person"), "sayHello").cast(FuncType) 을 시도한다.</li>
<li>Func.as() 혹은 Func.implicitCast(funcType) 이 되면서 delegator가 나오게 된다.</li>
</ul>
</li>
<li>객체의 명시적인 접근 없는 경우: <div class="fragment"><div class="line">def person</div>
<div class="line">    sayHello(name str) void</div>
<div class="line">    foo() sayHello</div>
<div class="line">        return sayHello</div>
<div class="line"> </div>
<div class="line">        ReturnExpr(AccessExpr(scope, &quot;sayHello&quot;))</div>
<div class="line">        // 구현상으로는 위의 케이스와 동일하게 AccessExpr이 담당하는 걸 알 수 있다.</div>
</div><!-- fragment --></li>
</ul>
<h1>Delegator가 생성될때 scope 캡처가 발생한다.</h1>
<ul>
<li>scope 캡처를 위한 chain 1개와 func에 대한 ref 1개를 갖는다.</li>
</ul>
<h1>메소드에 this는 값으로 접근했을때의 this이다.</h1>
<ul>
<li>임의의 객체를 통해서 메소드에 접근하였고 그것이 값으로써 다른 변수의 할당될때 해당 변수는 delegator로 정의된다.</li>
<li>delegator로 메소드가 값을 넣을때 delegator는 메소드 접근시 사용한 this를 capture해 놓는다.</li>
<li>클로져는 현재의 local scope 까지 capture하므로 delegator에서 구현이 하나 더 추가된 것이다.</li>
<li>delegator는 메소드가 호출되기 직전 capture한 scope를 load한다.</li>
<li>메소드가 끝나면 scope를 원상복구 시킨다.</li>
</ul>
<div class="fragment"><div class="line">def person</div>
<div class="line">    sayHello() void</div>
<div class="line">        sys.out(&quot;hello world&quot;)</div>
<div class="line"> </div>
<div class="line">p := person()</div>
<div class="line"> </div>
<div class="line">arr := [p.sayHello, person.sayHello]</div>
<div class="line">arr2 person.sayHello[] // 타입으로 접근한 것이므로 this는 무시된다.</div>
<div class="line">arr2 = arr</div>
<div class="line"> </div>
<div class="line">for fn in arr2</div>
<div class="line">    fn() // 사용시 this를 필요로 하지 않는다.</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
